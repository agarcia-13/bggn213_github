---
title: "Class05: Data Viz with GGPLOT"
author: "Alexandra Garcia (PID: A16278166)"
format: gfm
---

Today we are playing with plotting and graphics in R. 

There are lots of ways to make cool figures in R. 
There is "base" R graphics (`plot()`, `hist()`, `boxplot()` etc.)

There is also add-on packages, like **ggplot**.

```{r}
head(cars, 3)
```
Let's plot this with "base" R:
```{r}
plot(cars)
```
```{r}
head(mtcars)
```
Let's plot `mpg` vs `disp`
```{r}
plot(mtcars$mpg, mtcars$disp, pch=16)
```
```{r}
hist(mtcars$mpg)
```
## GGPLOT

The main function of GGPLOT2 package is `ggplot()`. First I need to install the **ggplot2** package. I can install any package with the function `install.package()`. You want to install this in console because you only need to install it once.

> **N.B.** I never want to run `install.packages()` in my quarto source document!!! Otherwise, you will be installing package every time you are running "render". 

Every time you use one of these add on packages, you have to load it in. 

>**N.B.** You want to load the function before you use it. Run `library()`

```{r}
library(ggplot2)
ggplot(cars) + 
  aes(x=speed, y=dist) + 
  geom_point()
```
```{r}
ggplot(cars) + 
  aes(speed) + 
  geom_histogram()
```
Every ggplot needs at least 3 things. 

- The **data** (given with `ggplot(cars)`)
- The **aesthetic** mapping (given with `aes()`)
- The **geom** (given with `geom_point()`)

> For simple canned graphs "base" R is always faster

### Adding more layers

Let's add a line
```{r}
library(ggplot2)
ggplot(cars) + 
  aes(x=speed, y=dist) + 
  geom_point() +
  geom_line()
```
```{r}
library(ggplot2)
ggplot(cars) + 
  aes(x=speed, y=dist) + 
  geom_point() +
  geom_smooth()
```

```{r}
library(ggplot2)
ggplot(cars) + 
  aes(x=speed, y=dist) + 
  geom_point() +
  geom_smooth(method = 'lm', se=FALSE)
```

### Adding more layers

Let's add a line and a title, subtitle, and caption as well as custom axis labels

```{r}
library(ggplot2)
ggplot(cars) + 
  aes(x=speed, y=dist) + 
  geom_point() +
  geom_smooth(method = 'lm', se=FALSE) + 
  labs(title = "First Plot", 
       subtitle = "Cars", 
       caption = "Speed x Distance", 
       x = "Speed (MPH)", 
       y = "Distance(ft)") +
  theme_classic()
```

## Plot some expression data

Read data file from online URL 

```{r}
url <- "https://bioboot.github.io/bimm143_S20/class-material/up_down_expression.txt"
genes <- read.delim(url)
head(genes)
```
> Q1 How many genes are in this dataset? 

There are `r nrow(genes)` in this dataset

> Q2. How many ‘up’ regulated genes are there?

```{r}
sum(genes$State == "up")
```
```{r}
table(genes$State)
```

Basic scatter plot
```{r}
ggplot(genes) + 
    aes(x=Condition1, y=Condition2) +
    geom_point()
```
Color by State
```{r}
ggplot(genes) + 
    aes(x=Condition1, y=Condition2, col=State) +
    geom_point()
```
What if you want to change the color palette? 
```{r}
p <- ggplot(genes) + 
    aes(x=Condition1, y=Condition2, col=State) +
    geom_point() +
    scale_color_manual(values=c("purple", "blue", "pink"))
```
What if I want to label every point (every gene)?

```{r}
ggplot(genes) + 
    aes(x=Condition1, 
        y=Condition2, 
        col=State, 
        label=Gene) +
    geom_point() +
    scale_color_manual(values=c("purple", "blue", "pink")) +
    geom_text()
```
This makes the plot look silly because it adds a label onto every coordinate point, which makes it hard to read. 

> Install `ggrepel` package in console and load it in using `library()`

```{r}
library(ggrepel)

ggplot(genes) + 
    aes(x=Condition1, 
        y=Condition2, 
        col=State, 
        label=Gene) +
    geom_point() +
    scale_color_manual(values=c("purple", "blue", "pink")) +
    geom_text() +
    geom_text_repel(max.overlaps = 60) + 
    theme_bw()
```
## Going further

Playing with more layers using gapminder dataset

```{r}
url <- "https://raw.githubusercontent.com/jennybc/gapminder/master/inst/extdata/gapminder.tsv"

gapminder <- read.delim(url)
```

```{r}
head(gapminder)
```
```{r}
tail(gapminder)
```
Make a plot of gdp per year (x) and gdp per cap (y) 

```{r}
ggplot(gapminder) +
  aes(x=gdpPercap, y=lifeExp) +
  geom_point()
```
Color it by continent

```{r}
ggplot(gapminder) +
  aes(x=gdpPercap, y=lifeExp, col=continent) +
  geom_point()
```
Divide it into different panels per continent

```{r}
ggplot(gapminder) +
  aes(x=gdpPercap, y=lifeExp, col=continent) +
  geom_point() +
  facet_wrap(~continent)
```

## Make a more interesting plot

I will be using animation

> In console, install `gifski` and `gganimate`

```{r}
library(gganimate)

ggplot(gapminder) + 
  aes(x=gdpPercap, y=lifeExp, size = pop, color = continent) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  scale_size(range = c(2, 12)) +
  scale_x_log10() +
  facet_wrap(~continent) +
  labs(title = 'Year: {frame_time}', x = 'GDP per capita', y = 'life expectancy') +
  transition_time(year) +
  shadow_wake(wake_length = 0.1, alpha = FALSE)
```

